before_script:
#- export LIB_CI_SCRIPT=https://github.com/home1-oss/oss-build/raw/develop/src/main/ci-script/lib_ci.sh
- export LIB_CI_SCRIPT=http://gitlab.local:10080/home1-oss/oss-build/raw/develop/src/main/ci-script/lib_ci.sh
- export ORIGIN_REPO_SLUG=home1-oss/oss-build

stages:
- test_and_build
- deploy

on_every_push:
  artifacts:
    expire_in: 1 day
    untracked: true
  script:
  - bash ci.sh test_and_build
  stage: test_and_build

on_develop_push:
  dependencies:
  - on_every_push
  only:
  - develop
  script:
  - bash ci.sh publish_snapshot publish_maven_site
  stage: deploy

on_master_push:
  dependencies:
  - on_every_push
  only:
  - master
  script:
  - bash ci.sh publish_release publish_maven_site
  stage: deploy

on_release_tag:
  only:
  - /^release.+$/
  script:
  - bash ci.sh publish_release_tag
  stage: deploy
